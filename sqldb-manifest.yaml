type: install
jpsVersion: 8.3.1
id: dbbench
name: DB Benchmarking
baseUrl: https://raw.githubusercontent.com/reclaimhosting/dbbench-jps/main
  
skipNodeEmails: true

nodes:
  nodeType: mysql
  nodeGroup: sqldb
  cloudlets: 32
  fixedcloudlets: 1
  extip: false

onInstall:
  - setup

actions:
  
  setup:
    cmd[sqldb]: |-
      yum update
      yum install sysbench -y
      curl ${baseUrl}/dbbench.sh -o /home/jelastic/dbbench.sh
      chmod +x /home/jelastic/dbbench.sh
      MYSQL_PWD=${nodes.sqldb.password} mysql -uroot -e "CREATE DATABASE test_db;"
      MYSQL_PWD=${nodes.sqldb.password} mysql -uroot -e "CREATE USER 'testuser'@'%' IDENTIFIED BY 'testpass';"
      MYSQL_PWD=${nodes.sqldb.password} mysql -uroot -e "GRANT ALL PRIVILEGES ON test_db.* TO 'testuser'@'%' WITH GRANT OPTION;"
